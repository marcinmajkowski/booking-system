"use strict";angular.module("bookingSystemApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","config"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl",controllerAs:"contact"}).otherwise({redirectTo:"/"}),b.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),angular.module("config",[]).constant("ENV",{name:"production",apiEndpoint:"http://api.bookingsystem.marcinmajkowski.com"}),angular.module("bookingSystemApp").controller("MainCtrl",["$scope","loginService","bookingService","trainingService",function(a,b,c,d){function e(){return d.getTrainings().then(function(b){return a.trainings=b,a.connected=!0,a.trainings})}a.trainings=[],a.connected=!1,a.open=function(a){b.authenticated?c.openBookingModal(b.customer,a):b.openLoginModal().result.then(function(){c.openBookingModal(b.customer,a)})},e()}]),angular.module("bookingSystemApp").controller("NavigationCtrl",["$scope","loginService",function(a,b){a.loginService=b}]),angular.module("bookingSystemApp").factory("bookingService",["$http","$uibModal","ENV",function(a,b,c){function d(a,c){return b.open({animation:!0,templateUrl:"views/booking.html",controller:"BookingCtrl",size:"md",resolve:{customer:function(){return a},training:function(){return c}}})}function e(b,d){a.post(c.apiEndpoint+"/v1/bookings",{customer:b._links.self.href,training:d._links.self.href})}return{openBookingModal:d,bookTraining:e}}]),angular.module("bookingSystemApp").factory("trainingService",["$log","$http","ENV",function(a,b,c){function d(){function d(a){return a.data._embedded.trainings}function e(b){a.error("XHR Failed for get trainings."+b.data)}return b.get(c.apiEndpoint+"/v1/trainings").then(d,e)}return{getTrainings:d}}]),angular.module("bookingSystemApp").factory("loginService",["$http","$uibModal","ENV",function(a,b,c){function d(){return b.open({animation:!0,templateUrl:"views/login.html",controller:"LoginCtrl",size:"sm",resolve:{}})}return{authenticate:function(b,d,e){var f=b?{authorization:"Basic "+btoa(b.username+":"+b.password)}:{},g=c.apiEndpoint+"/v1/customers/search/findByEmail?email="+b.username,h=this;a.get(g,{headers:f}).success(function(a){a.email?(h.authenticated=!0,h.customer=a,d&&d(a)):(h.authenticated=!1,e&&e())}).error(function(){h.authenticated=!1,e&&e()})},authenticated:!1,customer:{},openLoginModal:d}}]),angular.module("bookingSystemApp").controller("LoginCtrl",["$scope","$uibModalInstance","loginService",function(a,b,c){a.credentials={},a.error=!1;var d=function(){a.error=!1,a.ok()},e=function(){a.error=!0};a.login=function(){c.authenticate(a.credentials,d,e)},a.ok=function(){b.close(a.credentials)},a.cancel=function(){b.dismiss({})}}]),angular.module("bookingSystemApp").controller("BookingCtrl",["$scope","$uibModalInstance","customer","training","bookingService",function(a,b,c,d,e){a.customer=c,a.training=d,a.bookTraining=function(a,c){e.bookTraining(a,c),b.close({})},a.cancel=function(){b.dismiss({})}}]),angular.module("bookingSystemApp").controller("ContactCtrl",function(){}),angular.module("bookingSystemApp").run(["$templateCache",function(a){a.put("views/booking.html",'<div class="modal-header text-center"> <h3 class="modal-title">Potwierdzenie</h3> </div> <div class="modal-body"> <p>Chcesz zarezerwować miejsce na zajęciach <strong>{{ training.name }}</strong> dnia <strong>{{training.date | date:"MM/dd/yyyy"}}</strong> o godzinie <strong>{{training.date | date:"H:mm"}}</strong>.</p> <p>Na adres <strong>{{ customer.email }}</strong> zostanie wysłany link którego kliknięcie spowoduje potwierdzenie Twojej rezerwacji.</p> <button class="btn btn-primary btn-block" type="button" ng-click="bookTraining(customer, training)">Wyślij link potwierdzający</button> </div> <div class="modal-footer"> <button class="btn btn-default btn-block" type="button" ng-click="cancel()">Anuluj</button> </div>'),a.put("views/contact.html",'<div class="row"> <div class="panel panel-default col-sm-12 shadow"> <div class="panel-body"> Dane kontaktowe </div> </div> </div>'),a.put("views/login.html",'<div class="modal-header text-center"> <h3 class="modal-title">Masz karnet?</h3> </div> <div class="modal-body"> <div class="alert alert-danger" ng-show="error"> Czy to na pewno adres email przypisany do twojego karnetu? </div> <form role="form" ng-submit="login()" class="form-horizontal"> <div class="form-group"> <div class="col-sm-12"> <input type="text" class="form-control" id="email" name="email" placeholder="Email" ng-model="credentials.username"> </div> </div> <div class="form-group"> <div class="col-sm-12"> <input type="text" class="form-control" id="cardCode" name="cardCode" placeholder="Numer karnetu" ng-model="credentials.password"> </div> </div> <button class="btn btn-primary btn-block" type="submit">Zaloguj się</button> </form> </div> <div class="modal-footer"> <!-- TODO registration --> <button class="btn btn-default btn-block" type="button" ng-click="cancel()">Zarejestruj się</button> </div>'),a.put("views/main.html",'<div class="row" ng-if="connected"> <div class="list-group col-sm-12 shadow"> <a ng-repeat="training in trainings" href="#/" ng-click="open(training)" class="list-group-item"> <h4 class="list-group-item-heading">{{training.date | date:"MM/dd/yyyy \'-\' H:mm"}} - {{training.name}}</h4> <p class="list-group-item-text">({{training.capacity}} miejsc)</p> </a> </div> </div> <div class="row" ng-if="!connected"> <div class="panel panel-default text-center col-sm-12 shadow"> <p> <img src="../images/default.d684d18d.svg"><br> </p> <p> Oczekiwanie na połączenie z systemem rezerwacji </p> </div> </div>')}]);