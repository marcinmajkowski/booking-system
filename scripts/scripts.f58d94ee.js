"use strict";angular.module("bookingSystemApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","config"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl",controllerAs:"contact"}).otherwise({redirectTo:"/"}),b.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),angular.module("config",[]).constant("ENV",{name:"production",apiEndpoint:"http://api.bookingsystem.marcinmajkowski.com"}),angular.module("bookingSystemApp").controller("MainCtrl",["$scope","$log","loginService","bookingService","trainingService",function(a,b,c,d,e){function f(){return g().then(function(){b.info("Activated Trainings View")})}function g(){return e.getTrainings().then(function(b){return a.trainings=b,a.connected=!0,a.trainings})}this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.trainings=[],a.connected=!1,f(),a.open=function(a){c.authenticated?d.openBookingModal(c.customer,a):c.openLoginModal().result.then(function(){d.openBookingModal(c.customer,a)})}}]),angular.module("bookingSystemApp").controller("NavigationCtrl",["$scope","$log","$uibModal","loginService",function(a,b,c,d){a.loginService=d,a.openLoginModal=function(){var c=d.openLoginModal();c.result.then(function(c){a.credentials=c,b.info(a.credentials)},function(){b.info("Modal dismissed at: "+new Date)})}}]),angular.module("bookingSystemApp").factory("bookingService",["$log","$http","$uibModal","ENV",function(a,b,c,d){function e(){function c(b){return a.info(b),b.data._embedded.bookings}function e(b){a.error("XHR Failed for get bookings."+b.data)}return b.get(d.apiEndpoint+"/v1/bookings").then(c)["catch"](e)}var f=42;return{someMethod:function(){return f},get:e,openBookingModal:function(a,b){return c.open({animation:!0,templateUrl:"views/booking.html",controller:"BookingCtrl",size:"md",resolve:{customer:function(){return a},training:function(){return b}}})},bookTraining:function(b,c){a.info(b),a.info(c)}}}]),angular.module("bookingSystemApp").factory("trainingService",["$log","$http","ENV",function(a,b,c){function d(){function d(b){return a.info(b),b.data._embedded.trainings}function e(b){a.error("XHR Failed for get trainings."+b.data)}return b.get(c.apiEndpoint+"/v1/trainings").then(d)["catch"](e)}var e=42;return{someMethod:function(){return e},getTrainings:d}}]),angular.module("bookingSystemApp").factory("loginService",["$log","$http","$uibModal","ENV",function(a,b,c,d){return{authenticate:function(a,c,e){var f=a?{authorization:"Basic "+btoa(a.username+":"+a.password)}:{},g=d.apiEndpoint+"/v1/customers/search/findByEmail?email="+a.username,h=this;b.get(g,{headers:f}).success(function(a){a.email?(h.authenticated=!0,h.customer=a,c&&c(a)):(h.authenticated=!1,e&&e())}).error(function(){h.authenticated=!1,e&&e()})},authenticated:!1,customer:{},openLoginModal:function(){return c.open({animation:!0,templateUrl:"views/login.html",controller:"LoginCtrl",size:"sm",resolve:{}})}}}]),angular.module("bookingSystemApp").controller("LoginCtrl",["$log","$scope","$uibModalInstance","loginService",function(a,b,c,d){b.credentials={},b.error=!1;var e=function(c){a.info(c),b.error=!1,b.ok()},f=function(){b.error=!0};b.login=function(){d.authenticate(b.credentials,e,f)},b.ok=function(){c.close(b.credentials)},b.cancel=function(){c.dismiss({})}}]),angular.module("bookingSystemApp").controller("BookingCtrl",["$log","$scope","$uibModalInstance","customer","training",function(a,b,c,d,e){b.customer=d,b.training=e,b.bookTraining=function(b,d){a.info(b),a.info(d),c.close({})},b.cancel=function(){c.dismiss({})}}]),angular.module("bookingSystemApp").controller("ContactCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("bookingSystemApp").run(["$templateCache",function(a){a.put("views/booking.html",'<div class="modal-header text-center"> <h3 class="modal-title">Potwierdzenie</h3> </div> <div class="modal-body"> <p>Chcesz zarezerwować miejsce na zajęciach <strong>{{ training.name }}</strong> dnia <strong>{{training.date | date:"MM/dd/yyyy"}}</strong> o godzinie <strong>{{training.date | date:"H:mm"}}</strong>.</p> <p>Na adres <strong>{{ customer.email }}</strong> zostanie wysłany link którego kliknięcie spowoduje potwierdzenie Twojej rezerwacji.</p> <button class="btn btn-primary btn-block" type="button" ng-click="bookTraining(customer, training)">Wyślij link potwierdzający</button> </div> <div class="modal-footer"> <button class="btn btn-default btn-block" type="button" ng-click="cancel()">Anuluj</button> </div>'),a.put("views/contact.html",'<div class="row"> <div class="panel panel-default col-sm-12 shadow"> <div class="panel-body"> Dane kontaktowe </div> </div> </div>'),a.put("views/login.html",'<div class="modal-header text-center"> <h3 class="modal-title">Masz karnet?</h3> </div> <div class="modal-body"> <div class="alert alert-danger" ng-show="error"> Czy to na pewno adres email przypisany do twojego karnetu? </div> <form role="form" ng-submit="login()" class="form-horizontal"> <div class="form-group"> <div class="col-sm-12"> <input type="text" class="form-control" id="email" name="email" placeholder="Email" ng-model="credentials.username"> </div> </div> <div class="form-group"> <div class="col-sm-12"> <input type="text" class="form-control" id="cardCode" name="cardCode" placeholder="Numer karnetu" ng-model="credentials.password"> </div> </div> <button class="btn btn-primary btn-block" type="submit">Zaloguj się</button> </form> </div> <div class="modal-footer"> <!-- TODO registration --> <button class="btn btn-default btn-block" type="button" ng-click="cancel()">Zarejestruj się</button> </div>'),a.put("views/main.html",'<div class="row" ng-if="connected"> <div class="list-group col-sm-12 shadow"> <a ng-repeat="training in trainings" href="#/" ng-click="open(training)" class="list-group-item"> <h4 class="list-group-item-heading">{{training.date | date:"MM/dd/yyyy \'-\' H:mm"}} - {{training.name}}</h4> <p class="list-group-item-text">({{training.capacity}} miejsc)</p> </a> </div> </div> <div class="row" ng-if="!connected"> <div class="panel panel-default text-center col-sm-12 shadow"> <p> <img src="../images/default.d684d18d.svg"><br> </p> <p> Oczekiwanie na połączenie z systemem rezerwacji </p> </div> </div>')}]);